# schedule-editor-web
 Schedule editor, web version
# Web schedule editor
## Описание
Данное веб-приложение является основной частью системы управления мультимедийным контентом. Для данного веб-приложения реализованы вспомогательные серверы хранения контента и хранения плейлистов.  
Ссылка на сервер хранения плейлистов: https://github.com/purpl3mint/playlist-container-server  
Ссылка на сервер хранения контента: https://github.com/purpl3mint/content-server  
В приложении реализован сервис редактирования плейлистов для системы воспроизведения мудьтимедийного контента под управлением ACS.Eltex - сервера автоконфигурации - и приставок NV-720-WB производства компании ELTEX. 
Стек технологий: Node.js + Express.js + PostgreSQL + React.js  

## Установка
### Node.js
Для установки приложения необходимо установить Node.js версии не ниже 14.  
Установка для Windows: на сайте https://nodejs.org/en/ скачать версию LTS и установить через .msi пакет  
Установка для Ubuntu 16.04: необходимо выполнить следующие команды в консоли  
    `curl -sL https://deb.nodesource.com/setup_14.x -o nodesource_setup.sh`  
    `sudo bash nodesource_setup.sh`  
    `sudo apt-get install nodejs`  
Для проверки корректности установки Node можно выполнить команду  
    `node -v`  
Результатом команды будет версия установленного пакета Node.js.  

### PM2
Устанавливаем глобально PM2 (если не установлен) для контроля работоспособности приложения. В Ubuntu 16.04 выполняется это командой  
    `sudo npm i -g pm2`  
В Windows  
    `npm i -g pm2`  

### PostgreSQL
Установка для Windows довольно простая - скачиваем на официальном сайте установщик для версии 10. Задаем все необходимые настройки, логины и пароли.
После установки в pgAdmin создаем таблицу "web-schedule-editor" или любую другую. Ее название пригодится на этапе конфигурирования сервера. На этом настройка завершена.  
Для Ubuntu 16.04 устанавливаем командой  
    `sudo apt install postgresql postgresql-contrib -y`  
Создаем нового пользователя  
    `sudo -i -u postgres`  
    `createuser --interactive`  
    `/вводим имя нового пользователя/`  
    `/задаем как суперпаользователя через "y"/`  

Создаем новую базу данных  
    `create database 'web-schedule-editor'`  

Добавляем пользователя в базу данных  
    `psql -d 'web-schedule-editor'`  
    `ALTER USER (username) PASSWORD 'пароль';`  

### Установка приложения
Далее требуется клонировать текущий репозиторий в любую удобную папку. Это можно выполнить командой  
    `git clone https://github.com/purpl3mint/schedule-editor-web.git`  
После клонирования переходим в папку проекта командой  
    `cd content-server`  
Далее требуется установить модули Node.js для сервера командой  
    `npm i`  
Также модули должны быть установлены для клиента. Переходим в папку client  
    `cd client`  
И в ней также выполняем команду  
    `npm i`  

## Конфигурирование
### Настройка сервера
Из корневой папки проекта откроем файл конфигурации  
    `nano config/production.json`  
В этом файле указываем порт, на котором будет запущено приложение (рекомендуется 8082). Также прописываем все параметры базы данных для приложения (название, логин, пароль, хост и порт сервера базы данных). Также необходимо задать секретный ключ для хэширования паролей в базе данных. 
Также в этой папке приведены примеры файлов конфигурации, ориентируясь на которые можно легко задать свои настройки.

## Запуск приложения
Без pm2 приложение не запускаем, иначе может упасть и придется поднимать вручную. pm2 будет за этим следить. 
Сначала создадим задачу на запуск приложения. В корневой папке приложения вводим команду  
    `sudo pm2 start npm -- name "app-name" -- start`  
После этого будет создан процесс app-name. Остановить его можно командой  
    `sudo pm2 stop "app-name"`  
Повторно запускается командой  
    `sudo pm2 start "app-name"`  
Проверить статус всех существующих процессов можно командой  
    `sudo pm2 list`  

Если для pm2 не был настроен автозапуск, то нужно выполнить команду  
    `sudo pm2 startup`  
Он либо автоматом настроится, либо попросит ввести некоторую строку вида  
    `sudo env PATH=$...`  

## Использование
Для работы с редактором плейлистов в первую очередь необходимо добавить ссылки на контент, который требуется воспроизводить. Для этого переходим во вкладку "Контент"/"Баннеры"/"Бегущие строки" и добавляем нужные элементы с уникальными именами.  
После их добавления переходим во вкладку "Медиапланы" и создаем новый медиаплан. Обязательно выбирается уникальное имя для медиаплана.  
Далее требуется добавить в медиаплан различные элементы. Для этого нажимаем на блок подробной информации и попадаем в редактор. Здесь можно определить параметры для всего медиаплана (для их сохранения потребуется нажать кнопку, расположенную в самом низу блока параметров). Также здесь можно задавать контент для плейлиста. Для этого выбирается один из трех нужных типов контента и нажатием на блок с нужным названием элемента добавляется элемент в конец соответствующей группы. После задания всех элементов нажимается кнопка сохранения изменений плейлиста, находящаяся под блоком выбора элементов.  
После задания параметров и элементов плейлиста переходим во вкладку "Медиапланы" и нажатием на кнопку с иконкой дискеты сохраняем созданный плейлист в файл формата .json.  
Затем созданный файл плейлиста сохраняется на любом http сервере, позволяющем приставкам получать доступ к этому файлу. Такой сервер можно установить из репозитория https://github.com/purpl3mint/playlist-container-server  

## Добавление плейлиста в приставки
Чтобы приставка смогла воспроизвести плейлист необходимо правильно настроить приложение ad_player. В первую очередь требуется это приложение установить. Получить его можно в компании ELTEX. Устанавливаем его на приставку, заходим в сервер автоконфигурации ACS-BOX, который должен быть предварительно установлен и настроен. В интерфейсе должна отобразиться активная приставка.  
Заходим в дерево приложений, находим свойство "X_ELTEX_RU_APPCAST.App.1.Parameter.1" и задаем ему значение нашего плейлиста.  
Стоит отметить, что приставка не способна получать данные с серверов, работающих по протоколу HTTPS, поэтому плейлист и его элементы должны быть загружены на HTTP сервера.  
На этом настройка приставки завершена и она должна воспроизводить заданный плейлист.